# Supabase Setup untuk Helpdesk

## 1. Install Dependencies

Jalankan perintah berikut untuk menginstall Supabase client:

```bash
npm install @supabase/supabase-js
```

## 2. Environment Variables

Buat file `.env.local` di root folder helpdesk dengan konfigurasi berikut:

```env
# Supabase Configuration
NEXT_PUBLIC_SUPABASE_URL=your_supabase_project_url
NEXT_PUBLIC_SUPABASE_ANON_KEY=your_supabase_anon_key
```

## 3. Database Setup

Jalankan SQL berikut di Supabase SQL Editor untuk membuat tabel dan policy:

```sql
-- Policy untuk bucket helpdesk_media
CREATE POLICY "Public read access for helpdesk media" ON storage.objects
FOR SELECT USING (bucket_id = 'helpdesk_media');

-- Policy untuk bucket category_logos  
CREATE POLICY "Public read access for category logos" ON storage.objects
FOR SELECT USING (bucket_id = 'category_logos');

-- 1. Membuat tabel untuk Kategori
CREATE TABLE public.categories (
  id BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
  created_at TIMESTAMPTZ DEFAULT NOW() NOT NULL,
  name TEXT UNIQUE NOT NULL,
  icon_name TEXT, -- Nama ikon dari Tabler Icons, contoh: 'IconPencil'
  logo_url TEXT, -- URL logo kategori (dari Supabase Storage)
  description TEXT -- Deskripsi kategori
);

-- 2. Membuat tabel untuk Artikel
CREATE TABLE public.articles (
  id BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
  created_at TIMESTAMPTZ DEFAULT NOW() NOT NULL,
  question TEXT NOT NULL,
  answer TEXT, -- Jawaban dalam format Markdown
  category_id BIGINT NOT NULL,
  media_type TEXT, -- 'image', 'video', 'youtube'
  media_url TEXT, -- URL media dari Supabase Storage atau YouTube
  media_title TEXT, -- Judul media (opsional)
  media_description TEXT, -- Deskripsi media (opsional)
  
  CONSTRAINT fk_category
    FOREIGN KEY(category_id) 
    REFERENCES public.categories(id)
    ON DELETE CASCADE
);

-- 3. Aktifkan Row Level Security (RLS)
ALTER TABLE public.categories ENABLE ROW LEVEL SECURITY;
ALTER TABLE public.articles ENABLE ROW LEVEL SECURITY;

-- 4. Buat policy untuk public read access
CREATE POLICY "Allow public read access" 
ON public.categories FOR SELECT 
USING (true);

CREATE POLICY "Allow public read access" 
ON public.articles FOR SELECT 
USING (true);

-- 5. Insert data contoh
INSERT INTO public.categories (name, icon_name, description) VALUES
('SRE-Writer', 'IconPencil', 'Panduan lengkap untuk menggunakan SRE-Writer'),
('SRE-Brain', 'IconBrain', 'Fitur deteksi AI dan analisis konten');

-- 6. Insert artikel contoh
INSERT INTO public.articles (question, answer, category_id, media_type, media_url, media_title, media_description) VALUES
(
  '[Panduan Pemula] Apa itu platform SRE-HelpDesk?',
  'Platform SRE-HelpDesk adalah lingkungan penulisan terintegrasi yang dirancang untuk membantu pengguna dalam membuat dokumen akademis dan teknis berkualitas tinggi.',
  1,
  'youtube',
  'https://www.youtube.com/embed/dQw4w9WgXcQ',
  'Video Tutorial Lengkap SRE-Writer',
  'Video tutorial lengkap untuk memulai menggunakan platform SRE-HelpDesk'
),
(
  '[AI-Check] Bagaimana cara kerja deteksi AI?',
  'Kami menggunakan API GPTZero yang andal, layanan terkemuka dalam deteksi teks AI. Saat Anda mengklik Simpan Final, teks Anda dikirim dengan aman ke API.',
  2,
  'youtube',
  'https://www.youtube.com/embed/jNQXAC9IVRw',
  'Video Tutorial Deteksi AI',
  'Pelajari cara kerja fitur deteksi AI di SRE-Brain'
);
```

## 4. Storage Buckets (Opsional)

Jika ingin menggunakan storage untuk logo kategori dan media artikel:

1. Buat bucket `category_logos` di Supabase Storage
2. Buat bucket `helpdesk_media` di Supabase Storage
3. Policy sudah dibuat di SQL di atas

## 5. Fitur yang Tersedia

- ✅ Fetch kategori dari database
- ✅ Fetch artikel populer dari database  
- ✅ Live search artikel
- ✅ Fallback ke mock data jika Supabase tidak tersedia
- ✅ Loading states
- ✅ Error handling

## 6. Struktur Data

### Categories
- `id`: Primary key
- `name`: Nama kategori (unik)
- `icon_name`: Nama ikon (IconPencil, IconBrain, dll)
- `logo_url`: URL logo dari storage
- `description`: Deskripsi kategori

### Articles  
- `id`: Primary key
- `question`: Pertanyaan
- `answer`: Jawaban (Markdown)
- `category_id`: Foreign key ke categories
- `media_type`: Tipe media (image, video, youtube)
- `media_url`: URL media
- `media_title`: Judul media
- `media_description`: Deskripsi media

